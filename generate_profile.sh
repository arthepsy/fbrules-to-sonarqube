#!/bin/sh
_outdir='build'
_sqrules='sq_rules.dat'
_rules_src=${_outdir}'/rules-*.xml'
_profile=${_outdir}'/profile-findbugs.xml'

cd $(dirname $0) && mkdir -p ${_outdir}
echo '<?xml version="1.0" encoding="UTF-8"?>' > ${_profile}
echo '<!-- generated by fb2sq -->' >> ${_profile}
echo '<FindBugsFilter>' >> ${_profile}
for i in `grep '<rule key=' ${_rules_src} | cut -d '"' -f 2`; do
	d=$(grep "^$i:" ${_sqrules} | grep -q ':DISABLED' && echo 1)
	if [ "$d" != "1" ]; then
		echo '  <Match>' >> ${_profile}
		echo "    <Bug pattern=\"$i\"/>" >> ${_profile}
		echo '  </Match>' >> ${_profile}
	fi
done
echo '</FindBugsFilter>' >> ${_profile}
